var mynotifications=[];AddOnLoadPopupMethod(setRecaptcha);AddOnLoadPopupMethod(set_dependable_fields);AddOnLoadPopupMethod(SetTag);AddOnGridLoadComplete(gridsubmenu);AddOnLoadPopupMethod(setMultiSelect);var addOnNewnotification=[];var addOnNewCheckerResponse=[];var addOnNewInterval=[];function AddMethodOnNewNotification(a){addOnNewnotification.push(a)}function AddMethodOnCheckerResponse(a){addOnNewCheckerResponse.push(a)}function AddMethodOnInterval(a){addOnNewInterval.push(a)}$(function(){setLikeDislike();add_cloner_button();set_dependable_fields();setMultiSelect();AddMethodOnCheckerResponse(checkChatMessage);try{if(appGlobalLang.current_user_type=="AD"){try{setTimeout(CheckOnlineNotification,2000)}catch(a){}}}catch(a){}set_app_noti_click();setKnowledgeDetailsImg();if(appGlobalLang.isAdminLoggedIn){update_basic_conf(appGlobalLang.isAdminChatEnable);AddMethodOnInterval(app_check_param);AddMethodOnInterval(app_hide_notification)}setInterval(function(){try{for(i in addOnNewInterval){addOnNewInterval[i]()}}catch(b){}},1000)});function update_basic_conf(a){try{var c=new Date();localStorage.setItem("_basic_param",JSON.stringify({updateTime:c.getTime(),isChatEnabled:a}));window.lastBasicParamCheckTime=c.getTime();if(a){$("#chatstatus").prop("checked",true)}else{$("#chatstatus").prop("checked",false)}appGlobalLang.isAdminChatEnable=a}catch(b){}}function app_check_param(){try{var b=localStorage.getItem("_basic_param");if(b){var a=JSON.parse(b);if(typeof a=="object"){if(window.lastBasicParamCheckTime===undefined){window.lastBasicParamCheckTime=0}var f=new Date();if(a.updateTime>window.lastBasicParamCheckTime){if(a.isChatEnabled){$("#chatstatus").prop("checked",true)}else{$("#chatstatus").prop("checked",false)}window.lastBasicParamCheckTime=a.updateTime}}}}catch(c){}}function gridsubmenu(){try{$(".app-grid-submenu-box").remove()}catch(a){}$(".app-grid-dropdown").appdropdown({submenuClass:"app-grid-submenu-box"})}function ShowPopupForm(c,a){if(typeof a=="undefined"){a=false}var f=$('<a data-effect="mfp-move-from-top">').attr("href",c);var b="Loading";try{b=appGlobalLang.Loading}catch(d){b="Loading"}f.magnificPopup({type:"ajax",preloader:true,removalDelay:500,closeBtnInside:true,overflowY:"auto",closeOnBgClick:false,fixedBgPos:false,zoom:{enabled:false},tLoading:'<i class="fa fa-circle-o faa-burst animated"></i> &nbsp;'+b+"..",callbacks:{beforeOpen:function(){this.st.mainClass=this.st.el.attr("data-effect")},open:function(){},close:OnClosed,updateStatus:function(e){if(e.status==="ready"){_popupajaxLoadComplted()}}}}).click()}function recaptchaCall(){$(".g-recaptcha").each(function(){var b=$(this).attr("id");var a=$(this).data("sitekey");$(this).addClass("added-recpatcha");grecaptcha.render(b,{sitekey:a,callback:function(){}})})}function setKnowledgeDetailsImg(){$(".kn-details-container img:not(.popupimg,.Popupimg)").magnificPopup({type:"image",closeOnContentClick:true,mainClass:"mfp-img-mobile",callbacks:{resize:function(){var a=this.content.find("img");a.css("max-height",$(window).height()-50);a.css("width","auto");a.css("max-width","auto")},elementParse:function(a){try{if(a.el.context.tagName.toUpperCase()=="IMG"){a.src=a.el.attr("src")}}catch(b){try{if(a.el[0].nodeName=="IMG"){a.src=a.el[0].src}}catch(c){}}}}})}function system_msg_dismiss(b,a){swal(b.status?"Success":"Failed",b.msg,b.status?"success":"error");if(b.status){a.parent(".system-msg").fadeOut()}}function set_app_noti_click(){}function insert_edittor_text(c,b){try{$("#"+c).summernote("editor.insertText",b);return}catch(a){}try{CKEDITOR.instances[c].insertHtml(b);return}catch(a){}try{$("#"+c).froalaEditor("html.insert",b,true);return}catch(a){}try{insertAtCursor(c,b)}catch(a){}}function set_edittor_text(c,b){try{$("#"+c).summernote("code",b);return}catch(a){}try{CKEDITOR.instances[c].setData(b);return}catch(a){}try{$("#"+c).froalaEditor("html.set",b);return}catch(a){}try{$("#"+c).html(b)}catch(a){}}function insertAtCursor(d,c){if(document.selection){d.focus();sel=document.selection.createRange();sel.text=c}else{if(d.selectionStart||d.selectionStart=="0"){var b=d.selectionStart;var a=d.selectionEnd;d.value=d.value.substring(0,b)+c+d.value.substring(a,d.value.length)}else{d.value+=c}}}function set_dependable_fields(){var a=[];$(".has_depend_fld:not(.added-dpnds)").each(function(){var e=$(this);var d=e.attr("type");var b=e.data("class-prefix");var c=e.attr("name");if(!b){b="fld-"+c.replace(/[\[\]\_]/g,"-").replace(/\-$/g,"")}e.addClass("added-dpnds");if(a.indexOf("[name="+c+"]")==-1){a.push("[name="+c+"]");$("[name='"+c+"']").on("change",function(f){setDependableSettings(e,b)});setDependableSettings(e,b)}});$(".has_depend_fld2:not(.added-dpnds)").each(function(){var e=$(this);var d=e.attr("type");var b=e.data("class-prefix");var c=e.attr("name");if(!b){b="fld-"+c.replace(/[\[\]\_]/g,"-").replace(/\-$/g,"")}e.addClass("added-dpnds");if(a.indexOf("[name="+c+"]")==-1){a.push("[name="+c+"]");$("[name='"+c+"']").on("change",function(f){setDependableSettings2(e,b)});setDependableSettings2(e,b,true)}})}function setDependableSettings(d,a){try{var b=d.attr("name");var c=d.attr("type");if(c=="checkbox"||c=="radio"){var f=$("[name='"+b+"']:checked").val();if(f==undefined){f=$("[name='"+b+"'][type=hidden]").val()}}else{var f=$("[name='"+b+"']").val()}if(f){f=f.toLowerCase();var h=$("."+a+":not(."+a+"-"+f+")");if(h.length>0){h.fadeOut("fast",function(){h.find("input,select,textarea").prop("disabled",true);showDependableSettings(a,f)})}else{showDependableSettings(a,f)}d.closest("form").find("[type=submit]").prop("disabled",false)}}catch(g){}}function setDependableSettings2(d,a,h){try{var b=d.attr("name");var c=d.attr("type");if(c=="checkbox"||c=="radio"){var f=$("[name='"+b+"']:checked").val();if(f==undefined){f=$("[name='"+b+"'][type=hidden]").val()}}else{var f=$("[name='"+b+"']").val()}if(f){f=f.toLowerCase();var j=$("."+a+":not(."+a+"-"+f+")");if(j.length>0){j.find("input,select,textarea").prop("disabled",true);showDependableSettings2(a,f,h)}else{showDependableSettings2(a,f,h)}d.closest("form").find("[type=submit]").prop("disabled",false)}}catch(g){}}function showDependableSettings(b,c){var a=$("."+b+"-"+c).removeClass("hidden");a.fadeIn();a.find("input,select,textarea").prop("disabled",false)}function showDependableSettings2(b,d,e){var a=$("."+b+"-"+d);var c=a.find("input,select,textarea").prop("disabled",false);if(!e){c.first().focus()}}function setMultiSelect(){$(".app-multi-select:not(.ev-added)").addClass("ev-added").each(function(){var b=$(this);var c=b.data("name");var a=$('<input type="hidden" name="'+c+'">');b.prepend(a);b.find("> .apm-option").on("click",function(d){d.preventDefault();var f=$(this).data("value");a.val(f)})})}function add_cloner_button(){var a=0;$(".add-cloner-button").each(function(d){var c=$(this).data("target");var b=$(this).data("container");var f=$("#"+c).clone();$(this).click(function(h){h.preventDefault();if(c){if($(this).data("clone-inc")){var g=f.clone();var j=g.attr("id");g.attr("id",j+"-"+a);g.find("input,select").each(function(){var e=$(this).attr("id");$(this).attr("id",e+"-"+a)});a++}if(b){$(b).append(g)}else{$(this).before(g)}}})})}function setRecaptcha(){$(".g-recaptcha:not(.added-recpatcha)").each(function(){var b=$(this).attr("id");var a=$(this).data("sitekey");$(this).addClass(".added-recpatcha");grecaptcha.render(b,{sitekey:a})})}function setLikeDislike(){$("body").on("click",".kn-like-btn",function(b){b.preventDefault();var a=$(this);if(a.hasClass("kn-liked")){return}var c=a.data("kid");if(c){CallMyAjax(base_url+"knowledge/counter/like/"+c,{},function(){console.log("called");a.find("> i").addClass("app-fa-loading")},function(d){if(d.status){a.addClass("kn-liked");a.find("> i").removeClass("app-fa-loading");$("a.kn-dislike-btn[data-kid="+c+"]").fadeOut();$("#ld-msg-"+c).html(appGlobalLang.Liked);$(".kn-like-counter-"+c).each(function(){var e=$(this).text();e=parseInt(e);e++;$(this).text(e)})}else{a.find("> i").removeClass("app-fa-loading")}})}});$("body").on("click",".kn-dislike-btn",function(b){b.preventDefault();var a=$(this);if(a.hasClass("kn-disliked")){return}var c=a.data("kid");if(c){CallMyAjax(base_url+"knowledge/counter/dislike/"+c,{},function(){console.log("called");a.find("> i").addClass("app-fa-loading")},function(d){if(d.status){a.addClass("kn-disliked");a.find("> i").removeClass("app-fa-loading");$("a.kn-like-btn[data-kid="+c+"]").fadeOut();$("#ld-msg-"+c).html(appGlobalLang.Disliked);$(".kn-dislike-counter-"+c).each(function(){var e=$(this).text();e=parseInt(e);e++;$(this).text(e)})}else{a.find("> i").removeClass("app-fa-loading")}})}})}function AppAlert(a,c,b){if(typeof(b)=="undefined"){b=a?"Success":"Failed"}if(typeof(swal)=="function"){swal(b,c,a?"success":"error")}else{alert(c)}}function SetOnlineUpdate(){if(appGlobalLang.is_online_check){var a=getCookie(appGlobalLang.online_cookie_name);if(a=="Y"){$.getJSON(appGlobalLang.user_online_url,function(b){if(b.status){setTimeout(SetOnlineUpdate,appGlobalLang.online_cookie_interval)}})}}}function is_ok_noti_id(a){if(mynotifications.indexOf(a)>-1){return false}else{mynotifications.push(a);return true}}function app_process_online_notification(g){try{for(b in addOnNewCheckerResponse){addOnNewCheckerResponse[b](g)}}catch(f){}try{if(g.data.length>0){var d=false;var h=false;for(var b in g.data){if(is_ok_noti_id(g.data[b].id)){d=true;h=false;try{for(b in addOnNewnotification){var a=addOnNewnotification[b](g.data[b]);if(!h&&a){h=a}}}catch(f){}if(!h){ShowGritterMsg(g.data[b].body,true,false,g.data[b].title,g.data[b].icon,30000)}}}if(d&&appGlobalLang.is_noti_audio){try{var c=new Audio(appGlobalLang.noti_audio_path);c.play()}catch(f){gcl(f)}}if(d){try{update_notificationTry()}catch(f){}}ReloadShowNotificationAll()}}catch(f){}}function LoadNotiDatafromCache(){var b=localStorage.getItem("_notilastdata");if(b){var a=JSON.parse(b);if(typeof a=="object"){return a}}return null}function CheckOnlineNotification(){try{if(appGlobalLang.on_sec_noti&&appGlobalLang.current_user_type=="AD"){var a=false;var f=localStorage.getItem("_notilastcall");var h=new Date();var b=h.getTime()-f;if(b+3000<appGlobalLang.on_sec_noti_interval){var g=LoadNotiDatafromCache();if(g){app_process_online_notification(g);a=true}}if(!a){$.getJSON(appGlobalLang.on_sec_noti_url,function(j){var e=new Date();localStorage.setItem("_notilastcall",e.getTime());localStorage.setItem("_notilastdata",JSON.stringify(j));app_process_online_notification(j)})}setTimeout(CheckOnlineNotification,appGlobalLang.on_sec_noti_interval+2)}}catch(c){}}function checkChatMessage(c){if(window.chatData===undefined){window.chatData=[]}var a=c.chat_data;if(a.length>0){for(var b in a){if(window.chatData[a[b].id]===undefined&&!isExistUserResponse(a[b].id)){showMessage(a[b])}}}}function open_chat_page(){gcl("Called open chat page");try{var a=localStorage.getItem("adchatwindow");if(a==null&&appGlobalLang.chat_windo_url!==undefined){var c=window.open(appGlobalLang.chat_windo_url,"_blank");c.focus()}}catch(b){gcl(b)}}function showMessage(d){try{var j=$('<button data-cht-id="'+d.id+'" class="noti-btn btn btn-sm btn-white">'+appGlobalLang.chat_take_btn_text+"</button>");var c=$('<button  data-cht-id="'+d.id+'" class="noti-btn btn btn-sm btn-danger">'+appGlobalLang.chat_cancel_btn_text+"</button>");j.on("click",function(m){m.preventDefault();m.stopPropagation();var l=$(this).html();$(this).html('<i class="fa fa-spinner fa-spin"></i>');$.getJSON(appGlobalLang.chat_base_url+"/"+d.id+"/Y",function(e){if(e.status){j.appNotiElem.hide(function(){ShowGritterMsg(e.msg,e.status,e.is_sticky,e.title,e.icon)})}else{j.html(l)}});open_chat_page();AddToChatResponse(d.id)});c.on("click",function(m){m.preventDefault();m.stopPropagation();var l=$(this).html();$(this).html('<i class="fa fa-spinner fa-spin"></i>');$.getJSON(appGlobalLang.chat_base_url+"/"+d.id+"/N",function(e){if(e.status){c.appNotiElem.hide()}else{c.html(l);ShowGritterMsg(e.msg,e.status,e.is_sticky,e.title,e.icon)}});AddToChatResponse(d.id)});var g=$("<div>").append(j).append(c);var h=$("<strong>"+appGlobalLang.chat_take_msg_text+"</strong>");var b=$("<div>").append(h).append(g);var k={id:"cht-"+d.id,title:appGlobalLang.chat_new_chat_text,style:"info",theme:"right-bottom.css",timeout:null,message:b,icon:" ap ap-chat3  faa-ring animated"};var a=new notify(k);a.show();j.appNotiElem=a;c.appNotiElem=a;window.chatData[d.id]={id:d.id,elem:a};try{PlayChatAudio(d.id)}catch(f){gcl(f)}}catch(f){gcl(f)}}function PlayChatAudio(c){if(window.playingid===undefined){window.playingid=[]}if(window.chatData[c]!==undefined&&!isExistUserResponse(c)){try{if(window.playingid[c]!==undefined||!isExistPlayedResponse(c)){var a=new Audio(appGlobalLang.chattone_audio_path);a.play();AddToChatRingPlayingId(c);window.playingid[c]=c;setTimeout(function(){PlayChatAudio(c)},10000)}}catch(b){gcl(b)}}}function isExistUserResponse(b){var a=getChatResponse();if(!a){return false}return a.indexOf(b)>-1}function AddToChatResponse(b){if(!b){return}if(isExistUserResponse(b)){return}var a=getChatResponse();if(!a){a=[]}if(a.length>10){a=a.slice(-9)}a.push(b);localStorage.setItem("_cht_user_res",JSON.stringify(a))}function getChatResponse(){var b=localStorage.getItem("_cht_user_res");if(b){var a=JSON.parse(b);if(typeof a=="object"){return a}}return null}function getPlayedResponse(){var b=localStorage.getItem("_cht_played");if(b){var a=JSON.parse(b);if(typeof a=="object"){return a}}return null}function AddToChatRingPlayingId(b){if(!b){return}if(isExistPlayedResponse(b)){return}var a=getPlayedResponse();if(!a){a=[]}if(a.length>10){a=a.slice(-9)}a.push(b);localStorage.setItem("_cht_played",JSON.stringify(a))}function isExistPlayedResponse(b){var a=getPlayedResponse();if(!a){return false}return a.indexOf(b)>-1}function app_hide_notification(){for(var a in window.chatData){try{if(isExistUserResponse(window.chatData[a].id)){window.chatData[a].elem.hide();window.chatData.splice(a,1)}}catch(b){}}}function update_notificationTry(){$.get(appGlobalLang.update_notification_try,function(a){$("#app_noti_container").html(a);try{setPopUpAjax()}catch(b){}})};